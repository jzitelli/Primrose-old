THREE.VREffect=function(a,b,c){function d(a){for(var d=0;d<a.length;d++)if(a[d]instanceof HMDVRDevice){if(h=a[d],void 0!==h.getEyeParameters){var e=h.getEyeParameters("left"),f=h.getEyeParameters("right");i=e.eyeTranslation,k=f.eyeTranslation,j=e.recommendedFieldOfView,l=f.recommendedFieldOfView}else i=h.getEyeTranslation("left"),k=h.getEyeTranslation("right"),j=h.getRecommendedEyeFieldOfView("left"),l=h.getRecommendedEyeFieldOfView("right");var o=void 0!==c?c.near:.1,p=void 0!==c?c.far:1e3;r.projectionMatrix.copy(g(j,!0,o,p)),s.projectionMatrix.copy(g(l,!0,o,p)),m.makeTranslation(this.scale*i.x,this.scale*i.y,this.scale*i.z),n.makeTranslation(this.scale*k.x,this.scale*k.y,this.scale*k.z);break}void 0===h&&b&&b("HMD not available")}function e(a){var b=2/(a.leftTan+a.rightTan),c=(a.leftTan-a.rightTan)*b*.5,d=2/(a.upTan+a.downTan),e=(a.upTan-a.downTan)*d*.5;return{scale:[b,d],offset:[c,e]}}function f(a,b,c,d){b=void 0===b?!0:b,c=void 0===c?.01:c,d=void 0===d?1e4:d;var f=b?-1:1,g=new THREE.Matrix4,h=g.elements,i=e(a);return h[0]=i.scale[0],h[1]=0,h[2]=i.offset[0]*f,h[3]=0,h[4]=0,h[5]=i.scale[1],h[6]=-i.offset[1]*f,h[7]=0,h[8]=0,h[9]=0,h[10]=d/(c-d)*-f,h[11]=d*c/(c-d),h[12]=0,h[13]=0,h[14]=f,h[15]=0,g.transpose(),g}function g(a,b,c,d){var e=Math.PI/180,g={upTan:Math.tan(a.upDegrees*e),downTan:Math.tan(a.downDegrees*e),leftTan:Math.tan(a.leftDegrees*e),rightTan:Math.tan(a.rightDegrees*e)};return f(g,b,c,d)}var h,i,j,k,l,m=new THREE.Matrix4,n=new THREE.Matrix4;navigator.getVRDevices&&navigator.getVRDevices().then(d.bind(this)),this.scale=1,this.setSize=function(b,c){a.setSize(b,c)};var o=!1,p=a.domElement,q=p.mozRequestFullScreen?"mozfullscreenchange":"webkitfullscreenchange";document.addEventListener(q,function(a){o=document.mozFullScreenElement||document.webkitFullscreenElement},!1),this.setFullScreen=function(a){void 0!==h&&o!==a&&(p.mozRequestFullScreen?p.mozRequestFullScreen({vrDisplay:h}):p.webkitRequestFullscreen&&p.webkitRequestFullscreen({vrDisplay:h}))};var r=new THREE.PerspectiveCamera,s=new THREE.PerspectiveCamera;r.matrixAutoUpdate=!1,s.matrixAutoUpdate=!1,this.render=function(b,c){if(h){var d,e,f;Array.isArray(b)?(d=b[0],e=b[1]):(d=b,e=b,f=b.autoUpdate,f===!0&&(b.updateMatrixWorld(),b.autoUpdate=!1));var g=a.getSize();return g.width/=2,a.enableScissorTest(!0),a.clear(),null===c.parent&&c.updateMatrixWorld(),a.setViewport(0,0,g.width,g.height),a.setScissor(0,0,g.width,g.height),r.matrixWorld.multiplyMatrices(c.matrixWorld,m),a.render(d,r),a.setViewport(g.width,0,g.width,g.height),a.setScissor(g.width,0,g.width,g.height),s.matrixWorld.multiplyMatrices(c.matrixWorld,n),a.render(e,s),a.enableScissorTest(!1),void(f===!0&&(b.autoUpdate=f))}Array.isArray(b)&&(b=b[0]),a.render(b,c)}};